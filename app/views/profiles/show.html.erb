<div class="max-w-4xl mx-auto px-4 mt-6 md:mt-12 mb-20">
  <div class="bg-white rounded-[2.5rem] shadow-xl shadow-orange-100/50 overflow-hidden border border-orange-50">
    
    <div class="animate-fade-in-up h-64 bg-gradient-to-br from-orange-200 via-orange-400 to-red-500 relative overflow-hidden"
        style="animation-delay: 0.1s; opacity: 0; animation-fill-mode: forwards;">
      <div class="absolute -right-10 -bottom-10 w-64 h-64 bg-white/10 rounded-full blur-3xl"></div>
      <div class="absolute left-1/4 top-0 w-32 h-32 bg-yellow-300/10 rounded-full blur-2xl"></div>
      
      <div class="absolute inset-0 flex flex-col justify-between items-end p-6 md:p-10 pb-16">
        <div class="bg-white/20 backdrop-blur-md border border-white/30 rounded-full px-4 py-1.5 shadow-sm">
          <div class="flex items-center gap-2">
            <span class="text-lg"><%= @user.cooking_rank[:icon] %></span>
            <span class="text-white font-black text-xs tracking-widest uppercase"><%= @user.cooking_rank[:name] %></span>
          </div>
        </div>

        <div class="text-right text-white drop-shadow-lg">
          <div class="mb-3">
            <p class="text-[10px] font-bold opacity-90 uppercase tracking-[0.2em] mb-1">Total Savings</p>
            <div class="flex items-baseline justify-end">
              <span class="text-xl font-bold mr-1">¥</span>
              <span class="text-5xl font-black tracking-tighter tabular-nums">
                <%= number_with_delimiter(@user.total_savings) %>
              </span>
            </div>
          </div>
          <div class="flex items-baseline justify-end opacity-90">
            <p class="text-[10px] font-bold uppercase tracking-[0.2em] mr-3">Total Cooked</p>
            <span class="text-2xl font-black"><%= @user.total_cooking_count %></span>
            <span class="text-sm font-bold ml-1">回</span>
          </div>
        </div>
      </div>
    </div>

    <div class="px-6 md:px-10 pb-10">
      
      <%# アバター & アクションボタン %>
      <div class="animate-fade-in-up relative -top-12 flex justify-between items-end"
          style="animation-delay: 0.3s; opacity: 0; animation-fill-mode: forwards;">
        <div class="p-1.5 bg-white rounded-full shadow-sm">
          <% if @user.avatar.attached? %>
            <%= image_tag @user.avatar, class: "w-28 h-28 md:w-36 md:h-36 rounded-full object-cover border-4 border-white" %>
          <% else %>
            <div class="w-28 h-28 md:w-36 md:h-36 rounded-full bg-stone-100 flex items-center justify-center text-4xl border-4 border-white text-stone-300">👤</div>
          <% end %>
        </div>

        <div class="flex gap-2 mb-2">
          <% if @user.share_uid.present? %>
            <%= link_to "https://twitter.com/intent/tweet?text=#{u("#{@user.name}さんの今月の自炊成果は...？")}&url=#{u(share_url(@user.share_uid))}", 
                class: "flex items-center bg-stone-900 text-white px-4 py-2.5 rounded-xl text-sm font-bold hover:bg-black transition shadow-lg active:scale-95", 
                target: '_blank' do %>
              <span class="mr-1.5">𝕏</span> シェア
            <% end %>
          <% end %>
          <%= link_to edit_profile_path, class: "bg-white border border-stone-200 px-4 py-2.5 rounded-xl text-sm font-bold text-stone-600 hover:bg-stone-50 transition shadow-sm active:scale-95" do %>
            編集
          <% end %>
        </div> 
      </div>

      <div class="animate-fade-in-up -mt-6 mb-8"
          style="animation-delay: 0.4s; opacity: 0; animation-fill-mode: forwards;">
        <h1 class="text-2xl md:text-3xl font-black text-stone-800"><%= @user.name %></h1>
        <p class="text-stone-400 text-sm font-medium"><%= @user.email %></p>
      </div>

      <div class="animate-fade-in-up grid grid-cols-2 gap-4 mb-10"
          style="animation-delay: 0.5s; opacity: 0; animation-fill-mode: forwards;">
        <div class="bg-orange-50/50 p-6 rounded-[2rem] text-center border border-orange-100/50">
          <p class="text-orange-400 text-[10px] uppercase font-black tracking-widest mb-2">今月の節約額</p>
          <div class="flex items-baseline justify-center text-orange-600">
            <span class="text-lg font-bold mr-0.5">¥</span>
            <span class="text-3xl md:text-5xl font-black tabular-nums tracking-tighter">
              <%= number_with_delimiter(@user.savings_this_month) %>
            </span>
          </div>
        </div>

        <div class="bg-emerald-50/50 p-6 rounded-[2rem] text-center border border-emerald-100/50">
          <p class="text-emerald-400 text-[10px] uppercase font-black tracking-widest mb-2">今月の自炊回数</p>
          <div class="flex items-baseline justify-center text-emerald-600">
            <span class="text-3xl md:text-5xl font-black tabular-nums tracking-tighter">
              <%= @user.count_this_month %>
            </span>
            <span class="text-sm font-bold ml-1">回</span>
          </div>
        </div>
      </div>
      
      <div class="animate-fade-in-up mb-10"
          style="animation-delay: 0.6s; opacity: 0; animation-fill-mode: forwards;">
        <h3 class="text-lg font-black text-stone-800 mb-5 flex items-center gap-2">
          📅 月別の自炊実績
        </h3>
        <div class="grid gap-3">
          <% @monthly_stats.each do |stat| %>
            <div class="flex items-center justify-between p-4 md:p-5 bg-stone-50/50 border border-stone-100 rounded-2xl hover:bg-white hover:shadow-md transition-all duration-300">
              <div class="font-bold text-stone-700">
                <%= stat.month.to_date.strftime("%Y年 %m月") rescue stat.month %>
              </div>
              <div class="flex gap-4 md:gap-8">
                <div class="text-right">
                  <p class="text-[9px] text-stone-400 font-black uppercase tracking-tighter">Savings</p>
                  <p class="text-emerald-600 font-black text-lg">¥<%= number_with_delimiter(stat.savings.to_i) %></p>
                </div>
                <div class="text-right border-l pl-4 md:pl-8 border-stone-200">
                  <p class="text-[9px] text-stone-400 font-black uppercase tracking-tighter">Cooked</p>
                  <p class="text-stone-800 font-black text-lg"><%= stat.count %><span class="text-[10px] ml-0.5 font-bold">回</span></p>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>

      <div class="animate-fade-in-up bg-stone-50/50 p-4 md:p-8 rounded-[2rem] border border-stone-100"
          style="animation-delay: 0.8s; opacity: 0; animation-fill-mode: forwards;">
        <h3 class="text-lg font-black text-stone-800 mb-6 flex items-center gap-2">
          <span>📈</span> 自炊節約の歩み
        </h3>
        <div class="relative w-full h-[250px] md:h-[350px]">
            <canvas id="savingsChart" 
                    data-labels="<%= @chart_labels.to_json %>" 
                    data-values="<%= @chart_values.to_json %>">
            </canvas>
        </div>
      </div>

    </div>
  </div>
</div>